#include <WiFi.h>
#include <WebServer.h>
#include <BLEDevice.h>
#include <BLEScan.h>

const char* s="ESP32";
const char* p="12345678";
WebServer sv(80);
BLEScan* sc;

void hR(){
  String h="<html><body><h1>Scan</h1>";
  int n=WiFi.scanNetworks();
  h+="<p>Net:"+String(n)+"</p>";
  for(int i=0;i<n&&i<5;i++){
    h+="<p>"+WiFi.SSID(i)+":"+String(WiFi.RSSI(i))+"dBm</p>";
  }
  h+="<button onclick='fetch(\"/jam\")'>Jam BT</button>";
  h+="</body></html>";
  sv.send(200,"text/html",h);
  WiFi.scanDelete();
}

void hJ(){
  sc=BLEDevice::getScan();
  sc->setActiveScan(1);
  sc->setInterval(5);
  sc->setWindow(4);
  sv.send(200,"text/plain","Jamming");
}

void setup(){
  WiFi.softAP(s,p);
  BLEDevice::init("");
  sv.on("/",hR);
  sv.on("/jam",hJ);
  sv.begin();
}

void loop(){
  sv.handleClient();
  if(sc){
    sc->start(1,0);
    sc->clearResults();
  }
}
